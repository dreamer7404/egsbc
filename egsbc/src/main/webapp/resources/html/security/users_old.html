<!-- widget grid -->
<section id="widget-grid" class="">

	<!-- row -->
	<div class="row">

		<!-- NEW WIDGET START -->
		<article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

			<!-- Widget ID (each widget will need unique ID)-->
			<div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-2" data-widget-editbutton="false">

				<header>
					<span class="widget-icon"> <i class="fa fa-table"></i> </span>
					<h2>Users </h2>

				</header>

				<!-- widget div-->
				<div>
						
						<table id="dtUsers" class="table table-striped table-bordered table-hover" width="100%">
							<thead>
								<tr>
									<th rowspan="2"><input name="select_all" id="example-select-all" type="checkbox" value="1"></th>
									<th colspan="2" class="text-center">aaa</th>
									<th colspan="3" class="text-center">bbb</th>
								</tr>
								<tr>
									<th>ID</th>
									<th class="text-center">PW</th>
									<th>Level</th>
									<th>Status</th>
									<th>DateTime</th>
								</tr>
							</thead>
						</table>
					
					</div>
					<!-- end widget content -->

				</div>
				<!-- end widget div -->

			</div>
			<!-- end widget -->

		</article>
		<!-- WIDGET END -->

	</div>

	<!-- end row -->

	<!-- end row -->
</section>
<!-- end widget grid -->


<!-- Modal -->
  <div class="modal" id="modalContent" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header" style="background-color:#474544;height:50px">
<!--           <button type="button" class="close" data-dismiss="modal">&times;</button> -->
          <h5 class="modal-title" style="color:#FFF">사용자 추가</h5>
        </div>
        <div class="modal-body">
          
          <form class="form-horizontal">
							
			<fieldset>
	          	<div class="form-group">
					<label class="col-md-2 control-label">아이디</label>
					<div class="col-md-10">
						<input class="form-control" placeholder="" type="text">
						<p class="help-block">
							아이디는 7자리 (숫자, 영문자 조합)
						</p>
					</div>
				</div>
				<div class="form-group">
					<label class="col-md-2 control-label">비밀번호</label>
					<div class="col-md-10">
						<input class="form-control" placeholder="" type="password">
						<p class="help-block">
							비밀번호는 9 자리 이상 (숫자, 영문자, 특수문자 조합)
						</p>
					</div>
				</div>
				
				<div class="form-group">
					<label class="col-md-2 control-label">레벨</label>
					<div class="col-md-10">
						<label class="radio radio-inline">
							<input type="radio" class="radiobox" name="rdoLevel" >
							<span>관리자</span> 
						</label>
						<label class="radio radio-inline">
							<input type="radio" class="radiobox" name="rdoLevel" checked="checked">
							<span>일반</span>  
						</label>
					</div>
				</div>
				
<!-- 				<div class="form-group"> -->
<!-- 					<label class="col-md-2 control-label">상태</label> -->
<!-- 					<div class="col-md-10"> -->
<!-- 						<label class="radio radio-inline"> -->
<!-- 							<input type="radio" class="radiobox" name="rdoStatus" checked="checked"> -->
<!-- 							<span>사용</span>  -->
<!-- 						</label> -->
<!-- 						<label class="radio radio-inline"> -->
<!-- 							<input type="radio" class="radiobox" name="rdoStatus"> -->
<!-- 							<span>사용중지</span>   -->
<!-- 						</label> -->
<!-- 					</div> -->
<!-- 				</div> -->
								
          	</fieldset>
          </form>	
          
        </div>
        <div class="modal-footer">
        	 <spqn id='ajax_loader' style="display: none;margin-right:30px">
		    	<label style="margin-right:10px">저장중</label><img src="/resources/img/loading.gif"></img>
			</spqn>
        	<button type="button" class="btn btn-primary"  id="btnSaveNew">저장</button>
          	<button type="button" class="btn btn-default" data-dismiss="modal" id="btnCloseNew">닫기</button>
        </div>
      </div>
    </div>
  </div>
  
 
  <!-- Message Modal -->
		  <div class="modal" id="modalMsg" role="dialog">
		    <div class="modal-dialog">
		      <!-- Modal content-->
		      <div class="modal-content">
		        <div class="modal-header" style="background-color:#404040">
		<!--           <button type="button" class="close" data-dismiss="modal">&times;</button> -->
		          	<h4 class="modal-title" style="color:#FFF">메시지</h4>
		        </div>
		        <div class="modal-body">
			        <div class="text-center" >
						<h3 id="msgContent"></h3>
					</div>
		        </div>
		        <div class="modal-footer">
		        	<button type="button" class="btn btn-primary" data-dismiss="modal" id="btnCloseNew">확인</button>
		        </div>
		      </div>
		    </div>
  		</div>     
  



<script type="text/javascript">

	var table;

	pageSetUp();
	
	
	// pagefunction	
	var pagefunction = function() {

			var responsiveHelper_datatable_col_reorder = undefined;
			var breakpointDefinition = {
				tablet : 1024,
				phone : 480
			};
    
		/*  
			'C': show/hide column, 
		*/
			table = $('#dtUsers').DataTable({
				"dom": "<'dt-toolbar'<'col-sm-4 col-xs-12'B><'col-sm-4 col-xs-12'><'col-sm-4 col-xs-12 hidden-xs'TC>r>"+ 
				"t"+
				"<'dt-toolbar-footer'<'col-sm-3 col-xs-12'l><'col-sm-6 col-xs-12'p><'col-sm-3 col-xs-12 hidden-xs text-right'i>>",

// 				"sDom": "<'dt-toolbar'<'col-xs-12 col-sm-6'f><'col-sm-6 col-xs-6 hidden-xs'C>r>"+
// 					"t"+
// 					"<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'B><'col-sm-6 col-xs-12'p>>",
				
				"oLanguage": {
					"sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
				},
				"autoWidth" : true,
				"preDrawCallback" : function() {
					// Initialize the responsive datatables helper once.
					if (!responsiveHelper_datatable_col_reorder) {
						responsiveHelper_datatable_col_reorder = new ResponsiveDatatablesHelper($('#dtUsers'), breakpointDefinition);
					}
				},
				"rowCallback" : function(nRow) {
					responsiveHelper_datatable_col_reorder.createExpandIcon(nRow);
				},
				"drawCallback" : function(oSettings) {
					responsiveHelper_datatable_col_reorder.respond();
				},
				"buttons": [
							{
							    //text: '<i class="fa fa-file-o"></i>',
							    text: '<span class="ui-icon ui-icon-plus"></span>',
							    titleAttr: 'New',
							    action: function ( e, dt, node, config ) {
							        add();
							    }
							},
				            {
				                text: '<span class="ui-icon ui-icon-pencil"></span>',
				                titleAttr: 'Edit',
				                action: function ( e, dt, node, config ) {  
				                   edit();
				                }
				            },
				            {
				            	text: '<span class="ui-icon ui-icon-close"></span>',
				                titleAttr: 'Delete',
				                action: function ( e, dt, node, config ) {
				                    remove();
				                }
				            },
				            {
				            	text: '<span class="ui-icon  ui-icon-arrowrefresh-1-w"></span>',
				                titleAttr: 'Refresh',
				                action: function ( e, dt, node, config ) {
				                    refresh();
				                }
				            },
				  ],
				 "tableTools": {
		        	 "aButtons": [
				             "xls",
				                {
				                    "sExtends": "pdf",
				                    "sTitle": "SmartAdmin_PDF",
				                    "sPdfMessage": "SmartAdmin PDF Export",
				                    "sPdfSize": "letter"
				                },
			         ],
		            "sSwfPath": "/resources/js/plugin/datatables/swf/copy_csv_xls_pdf.swf"
		        },
				"processing": true,
		        //"serverSide": true,
		        "ajax": {
		        	url: "/getUsers",
		        	type: "post"
		        },
			    "columns": [
					{ "data": "id"},        
			        { "data": "id" },
			        { "data": "pw" },
			        { "data": "level" },
			        { "data": "status"},
			        { "data": "dateTime" }
			    ],
			    'columnDefs': [
			        {
		        	'targets': 0,
		        	'width':'18px',
		        	'searchable': false,
		            'orderable': false,
		        	'className': 'text-center',
		        	'render': function (data, type, full, meta){
		                var val=$('<div/>').text(data).html();
		        		return '<input type="checkbox" name="id[]" value="' + val + '">';
		        		},
					},
					{
			        	'targets': 1,
			        	'className': 'text-center',
			        	'render': function(data, type, full, meta){
			        		var val=$('<div/>').text(data).html();
			        		return '<i class="fa fa-lg fa-fw fa-cog"></i> ' + data;
			        	}
					},
					{
			        	'targets': 2,
			        	'className': 'text-center',
					},
					{
			        	'targets': 3,
			        	'className': 'text-center',
					},
					{
			        	'targets': 4,
			        	'className': 'text-center',
					},
					{
			        	'targets': 5,
			        	'className': 'text-center',
					}
				],
				 'order': [[1, 'asc']],
			});
			
			
		 // Handle click on "Select all" control
		   $('#example-select-all').on('click', function(){ 
			      var rows = table.rows({ 'search': 'applied' }).nodes();
			      $('input[type="checkbox"]', rows).prop('checked', this.checked);
		   });

			
			
		   // Handle click on checkbox to set state of "Select all" control
		   $('#dtUsers tbody').on('change', 'input[type="checkbox"]', function(){
		      // If checkbox is not checked
		      if(!this.checked){
		         var el = $('#example-select-all').get(0);
		         // If "Select all" control is checked and has 'indeterminate' property
		         if(el && el.checked && ('indeterminate' in el)){
		            // Set visual state of "Select all" control 
		            // as 'indeterminate'
		            el.indeterminate = true;
		         }
		      }
		   });
		
		/* END COLUMN SHOW - HIDE */

		
		
 		$('#modalContent').on('shown.bs.modal', function() {
		    var initModalHeight = $('.modal-dialog').outerHeight(); //give an id to .mobile-dialog
		    var userScreenHeight = $(document).outerHeight();
		    if (initModalHeight > userScreenHeight) {
		        $('.modal-dialog').css('overflow', 'auto'); //set to overflow if no fit
		    } else {
		        $('.modal-dialog').css('margin-top', (userScreenHeight / 2) - (initModalHeight/2)); //center it if it does fit
		    }
		});
		
		
		
		/* Save New Button */
		$("#btnSaveNew").click(function(event){
			
			$("#ajax_loader").show();
			$("#btnCloseNew").attr("disabled", true);
			$(this).attr("disabled", true);

			// 응답왔을때 가정
 			/*  setTimeout(function(){
 			    	$("#ajax_loader").hide();
 			    	$("#btnCloseNew").attr("disabled", false);
 			    	$("#btnSaveNew").attr("disabled", false);
 			    	
 			    	$('#modalContent').modal('hide');
 			    	
 			    	$("#modalMsg").modal({ backdrop: 'static', keyboard: false });
 			    	$("#msgContent").html('<i class="fa fa-check" aria-hidden="true"></i> 저장되었습니다.');
 			    	
 			 },1000)
 */
 
 
 			$.post("/addUser",{}, function(json){
 				alert('json : ' + json.result);
 				
 				$("#ajax_loader").hide();
			    	$("#btnCloseNew").attr("disabled", false);
			    	$("#btnSaveNew").attr("disabled", false);
			    	
 			});
		});
 		
		
		
	};

	// load related plugins
	loadScript("/resources/js/plugin/datatables/jquery.dataTables.min.js", function(){
		loadScript("/resources/js/plugin/datatables/dataTables.colVis.min.js", function(){
			loadScript("/resources/js/plugin/datatables/dataTables.tableTools.min.js", function(){
				loadScript("/resources/js/plugin/datatables/dataTables.bootstrap.min.js", function(){
					loadScript("/resources/js/plugin/datatable-responsive/datatables.responsive.min.js", pagefunction)
				});
			});
		});
	});
	
	
	
	
	
	function add(){
		$("#modalContent").modal({
			backdrop: 'static',
			keyboard: false  
		});
	}
	
	function edit(){
		var s=getCheck();
		if(s==''){
			alert('수정할 항목을 선택해 주세요');
			return;
		}
		var arr=s.split(',');
		if(arr.length>1){
			alert('수정할 항목을 한개만 선택해 주세요!');
			return;
		}
		alert('edit ID : ' + s);
	}
	function remove(){
		var s=getCheck();
		if(s==''){
			alert('삭제할 항목을 선택해 주세요');
			return;
		}
		var arr=s.split(',');
		alert('remove ID : ' + s);
	}
	
		
	
	function refresh(){
		table.ajax.reload();
	}
	
	function getCheck(){   
	    var str="";
	    table.$('input[type="checkbox"]').each(function(){
	          if(this.checked){
	        	  if(str!=""){
	        		  str+=",";
	        	  }
	             str += this.value;
	          }
	    });
	    return str;
	}
	
	
	


</script>
