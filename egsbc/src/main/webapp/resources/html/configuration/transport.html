<!-- widget grid -->
<section id="widget-grid" class="">

	<!-- row -->
	<div class="row">

		<!-- NEW WIDGET START -->
		<article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

			<!-- Widget ID (each widget will need unique ID)-->
			<div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-2" data-widget-editbutton="false">
				<header>
					<span class="widget-icon"> <i class="fa fa-table"></i> </span>
					<h2>SIP Transport </h2>
				</header>
				<!-- widget div-->
				<div class="div-widget" >
						<table id="dtSip" class="table table-striped table-bordered table-hover"   >
							<thead>
								<tr>
									<th rowspan="2" class="text-center">Seq</th>
									
									<th rowspan="2" class="text-center">Name</th>
									<th rowspan="2" class="text-center">NIC Alias</th>
									
									<th colspan="3" class="text-center">Transport</th>
									<th colspan="2" class="text-center">Forking Port Range</th>
									<th colspan="2" class="text-center">Qos</th>
								</tr>
								<tr>
									<th class="text-center">Service</th>
									<th class="text-center">Type</th>
									<th class="text-center">Port</th>
									
									<th class="text-center">MIN</th>
									<th class="text-center">MAX</th>
									
									<th class="text-center">Type</th>
									<th class="text-center">Value</th>
								</tr>
							</thead>
						</table>
						<div class="form-group text-right">
							<button class="btn btn-default btn-add" id="btnAddSip">Add</button>
							<button class="btn btn-default btn-edit" id="btnChangeSip" >Edit</button>
							<button class="btn btn-default btn-delete" id="btnRemoveSip" >Delete</button>
							<button class="btn btn-default btn-refresh" id="btnRefreshSip">Refresh</button>
						</div>
				</div>
			</div>
			<div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-3" data-widget-editbutton="false">
				<header>
					<span class="widget-icon"> <i class="fa fa-table"></i> </span>
					<h2>Media Transport </h2>
				</header>

				<!-- widget div-->
				<div>
						<table id="dtMedia" class="table table-striped table-bordered table-hover"   >
							<thead>
								<tr>
									<th rowspan="2" class="text-center">Seq</th>
									
									<th rowspan="2" class="text-center">Name</th>
									<th rowspan="2" class="text-center">NIC Alias</th>
									
									<th colspan="2" class="text-center">Media Port Range</th>
									<th colspan="2" class="text-center">Qos</th>
								</tr>
								<tr>
									<th class="text-center">MIN</th>
									<th class="text-center">MAX</th>
									
									<th class="text-center">Type</th>
									<th class="text-center">Value</th>
								</tr>
							</thead>
						</table>
						<div class="form-group text-right">
							<button class="btn btn-default btn-add" id="btnAddMedia">Add</button>
							<button class="btn btn-default btn-edit" id="btnChangeMedia" >Edit</button>
							<button class="btn btn-default btn-delete" id="btnRemoveMedia" >Delete</button>
							<button class="btn btn-default btn-refresh" id="btnRefreshMedia">Refresh</button>
						</div>
				</div>
			</div>
			
			<div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-4" data-widget-editbutton="false" style="display:none">
				<header>
					<span class="widget-icon"> <i class="fa fa-table"></i> </span>
					<h2>NAT Transport </h2>
				</header>

				<!-- widget div-->
				<div>
						<table id="dtNat" class="table table-striped table-bordered table-hover"   >
							<thead>
								<tr>
									<th rowspan="2" class="text-center">Seq</th>
									
									<th rowspan="2" class="text-center">Name</th>
									<th rowspan="2" class="text-center">NIC Alias</th>
									
									<th colspan="2" class="text-center">Port Range</th>
									<th colspan="4" class="text-center">Operate Information</th>
								</tr>
								<tr>
									<th class="text-center">Min</th>
									<th class="text-center">Max</th>
									
									<th class="text-center">Protocol</th>
									<th class="text-center">param1</th>
									<th class="text-center">param2</th>
									<th class="text-center">param3</th>
								</tr>
							</thead>
						</table>
						<div class="form-group text-right">
							<button class="btn btn-default btn-add" id="btnAddNat">Add</button>
							<button class="btn btn-default btn-edit" id="btnChangeNat" >Edit</button>
							<button class="btn btn-default btn-delete" id="btnRemoveNat" >Delete</button>
							<button class="btn btn-default btn-refresh" id="btnRefreshNat">Refresh</button>
						</div>
				</div>
			</div>
			
			
		</article>
	</div>			
</section>	

<!-- Modal SIP -->
<div class="modal" id="modalSip" role="dialog">
    <div class="modal-dialog modal-vertical-centered"  style="width:430px">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header" style="height:40px;padding-top:10px;">
          <div class="modal-title" id="titleModalSip"></div>
        </div>
        <div class="modal-body">
          
					<div class="row" style="border:0px solid red;">
					
					<form class="smart-form" id="frmSip" novalidate="novalidate">
					
						<table border="0" style="margin:0 auto;">
						<tr>
							<td width="120px" class="td-label">*Name</td>
							<td colspan="3">
								<label class="input"  name="lblClass" >
									<input type="text" id="name" name="name" >
								</label>
							</td>
						</tr>
						<tr> 
 							<td colspan="4" class="td-hr"><hr class="hr-form" /></td> 
 						</tr> 
						<tr>
							<td class="td-label">*NIC Alias</td>
							<td colspan="3">
								<label class="select" name="lblClass">
									<select  id="vipName" name="vipName">
									</select> <i></i> </label>
							</td>
						</tr>
						<tr> 
 							<td colspan="4" class="td-hr"><hr class="hr-form" /></td> 
 						</tr> 
						<tr>
							<td class="td-label">*Service Port</td>
							<td colspan="3">
								<label class="input" name="lblClass">
									<input type="text" id="sigPort" name="sigPort" >
								</label>
							</td>
						</tr>
						<tr> 
 							<td colspan="4" class="td-hr"><hr class="hr-form" /></td> 
 						</tr> 
						<tr>
							<td class="td-label">*Service Type</td>
							<td colspan="3">
								<div class="inline-group" id="divSvcType">
									<label class="radio" name="lblClass">
										<input type="radio" name="svcType" value="0" checked>
										<i></i>Server/Realm
									</label>
									<label class="radio" name="lblClass">
										<input type="radio" name="svcType" value="1">
										<i></i>Trunk
									</label>
								</div>
							</td>
						</tr>
						<tr> 
 							<td colspan="4" class="td-hr"><hr class="hr-form" /></td> 
 						</tr> 
						<tr>
							<td class="td-label">*Transport Type</td>
							<td colspan="3">
								<div class="inline-group">
									<label class="radio" name="lblClass">
										<input type="radio" name="transType" value="1" checked>
										<i></i>UDP
									</label>
									<label class="radio" name="lblClass">
										<input type="radio" name="transType" value="2">
										<i></i>TCP
									</label>
									<label class="radio" name="lblClass">
										<input type="radio" name="transType" value="3">
										<i></i>TLS
									</label>
								</div>
							</td>
						</tr>
						<tr >
							<td colspan="4" class="td-hr"><hr class="hr-form-seperate" /></td> 
						</tr>
						<tr>
							<td class="td-label">Forking Port Range</td>
							<td align="left" width="92px">
								<label class="input" name="lblClass">
									<input type="text" style="width:90px" id="forkingMinport" name="forkingMinport"> 
								</label>
							<td style="width:20px" align="center">
								<span style="font-size:12px;color:#9B9B9B" class="glyphicon glyphicon-minus" name="lblClass"></span>
							</td>
							<td align="left">
								<label class="input" name="lblClass">
									<input type="text" style="width:90px" id="forkingMaxport" name="forkingMaxport">
								</label>
							</td>
						</tr>
						<tr> 
 							<td colspan="4" class="td-hr"><hr class="hr-form" /></td> 
 						</tr> 
						<tr>
							<td class="td-label">QoS Type</td>
							<td colspan="3">
								<div class="inline-group" >
									<label class="radio">
										<input type="radio" name="qosType" value="0" checked>
										<i></i>none
									</label>
									<label class="radio">
										<input type="radio" name="qosType" value="1">
										<i></i>ippre
									</label>
									<label class="radio">
										<input type="radio" name="qosType" value="2">
										<i></i>dscp
									</label>
								</div>
							</td>
						</tr>
						<tr> 
 							<td colspan="4" class="td-hr"><hr class="hr-form" /></td> 
 						</tr> 
						<tr>
							<td class="td-label">QoS Value(hex)</td>
							<td colspan="3">
								<label class="input">
									<input type="text" id="txtQosValue" name="qosValue">
								</label>
							</td>
						</tr>
						</table>
						
						<input type="hidden" id="hidOpMode" name="opMode"  >	
					</form>		
					</div>
					
			</div>
			<div class="modal-footer" style="height:50px;padding:10px 20px 0 0;">
	          	<button type="button" class="btn btn-default btn-save"  id="btnSaveSip">Save</button>
          		<button type="button" class="btn btn-default btn-close" data-dismiss="modal" >Close</button>
        	</div>
		</div>
	</div>	
</div>

<!-- Modal Media -->
<div class="modal" id="modalMedia" role="dialog">
    <div class="modal-dialog modal-vertical-centered"  style="width:430px">
      <div class="modal-content">
        <div class="modal-header backOceanBlue" style="height:40px;padding-top:10px;">
          <h6 class="modal-title txt-color-white" id="titleModalMedia"></h6>
        </div>
        <div class="modal-body">
          
					<div class="row" style="border:0px solid red;">
					
					<form class="smart-form" id="frmMedia" novalidate="novalidate">
					
						<table border="0" style="margin:0 auto;">
						<tr>
							<td class="td-label" width="110px">*Name</td>
							<td colspan="3">
								<label class="input"  name="lblClass" >
									<input type="text" id="name" name="name" >
								</label>
							</td>
						</tr>
						<tr> 
							<td colspan="4" class="td-hr"><hr class="hr-form" /></td> 
						</tr> 
						<tr>
							<td class="td-label">*NIC Alias</td>
							<td colspan="3">
								<label class="select" name="lblClass">
									<select  id="vipName" name="vipName">
									</select> <i></i> </label>
							</td>
						</tr>
						<tr> 
							<td colspan="4" class="td-hr"><hr class="hr-form" /></td> 
						</tr>
						<tr>
							<td class="td-label">Port Range</td>
							<td>
								<label class="input" name="lblClass">
									<input type="text" style="width:90px" id="minPort" name="minPort">
								</label>
							<td style="width:20px" align="center">~</td>
							<td align="left">
								<label class="input" name="lblClass">
									<input type="text" style="width:90px" id="maxPort" name="maxPort">
								</label>
							</td>
						</tr>
						<tr> 
							<td colspan="4" class="td-hr"><hr class="hr-form-seperate" /></td> 
						</tr>
						<tr>
							<td class="td-label">QoS Type</td>
							<td colspan="3">
								<div class="inline-group" >
									<label class="radio">
										<input type="radio" name="qosType" value="0" checked>
										<i></i>none
									</label>
									<label class="radio">
										<input type="radio" name="qosType" value="1">
										<i></i>ippre
									</label>
									<label class="radio">
										<input type="radio" name="qosType" value="2">
										<i></i>dscp
									</label>
								</div>
							</td>
						</tr>
						<tr> 
							<td colspan="4" class="td-hr"><hr class="hr-form" /></td> 
						</tr>
						<tr>
							<td class="td-label">QoS Value(hex)</td>
							<td colspan="3">
								<label class="input">
									<input type="text" id="qosValue" name="qosValue">
								</label>
							</td>
						</tr>
						</table>
						
						<input type="hidden" id="hidOpMode" name="opMode"  >	
					</form>		
					</div>
					
			</div>
			<div class="modal-footer" style="height:50px;padding:10px 20px 0 0;">
	          	<button type="button" class="btn btn-default btn-save"  id="btnSaveMedia">Save</button>
          		<button type="button" class="btn btn-default btn-close" data-dismiss="modal" >Close</button>
        	</div>
		</div>
	</div>	
</div>

<!-- Modal Nat -->
<div class="modal" id="modalNat" role="dialog">
    <div class="modal-dialog modal-vertical-centered"  style="width:430px">
      <div class="modal-content">
        <div class="modal-header backOceanBlue" style="height:40px;padding-top:10px;">
          <h6 class="modal-title txt-color-white" id="titleModalNat"></h6>
        </div>
        <div class="modal-body">
          
					<div class="row" style="border:0px solid red;">
					
					<form class="smart-form" id="frmNat" novalidate="novalidate">
					
						<table border="0" style="margin:0 auto;">
						<tr>
							<td width="120px" class="td-label">*Name</td>
							<td colspan="3">
								<label class="input"  name="lblClass" >
									<input type="text" id="name" name="name" >
								</label>
							</td>
						</tr>
						<tr> 
							<td colspan="4" class="td-hr"><hr class="hr-form" /></td>  
						</tr>
						<tr>
							<td class="td-label">*NIC Alias</td>
							<td colspan="3">
								<label class="select" name="lblClass">
									<select  id="vipName" name="vipName">
									</select> <i></i> </label>
							</td>
						</tr>
						<tr> 
							<td colspan="4" class="td-hr"><hr class="hr-form" /></td>  
						</tr>
						<tr>
							<td class="td-label">*Port Range</td>
							<td>
								<label class="input" name="lblClass">
									<input type="text" style="width:90px" id="minPort" name="minPort">
								</label>
							<td style="width:20px" align="center">~</td>
							<td align="left">
								<label class="input" name="lblClass">
									<input type="text" style="width:90px" id="maxPort" name="maxPort">
								</label>
							</td>
						</tr>
						<tr> 
							<td colspan="4" class="td-hr"><hr class="hr-form-seperate" /></td>  
						</tr>
						<tr>
							<td class="td-label">Protocol Type</td>
							<td colspan="3">
								<div class="inline-group" >
									<label class="radio">
										<input type="radio" name="protocol" value="0" checked>
										<i></i>ALL
									</label>
									<label class="radio">
										<input type="radio" name="protocol" value="1">
										<i></i>UDP
									</label>
									<label class="radio">
										<input type="radio" name="protocol" value="2">
										<i></i>TCP
									</label>
								</div>
							</td>
						</tr>
						</table>
						
						<input type="hidden" id="hidOpMode" name="opMode"  >	
					</form>		
					</div>
					
			</div>
			<div class="modal-footer" style="height:50px;padding:10px 20px 0 0;">
	          	<button type="button" class="btn btn-default btn-save"  id="btnSaveNat">Save</button>
          		<button type="button" class="btn btn-default btn-close" data-dismiss="modal" >Close</button>
        	</div>
		</div>
	</div>	
</div>


<script type="text/javascript">
var tableSip, tableMedia, tableNat;
var validatorSip, validatorMedia, validatorNat;

var pagefunction = function() {
	
	tableSip = $('#dtSip').DataTable({
		"sDom": sDom,
		"oLanguage": oLanguage,
		"autoWidth" : true,
		"tableTools":tableTools,
		"scrollY" : "400px",
		"scrollX" : false,
			"scrollCollapse": true,
		"paging": false,
		"processing": true,
        "ajax": {
        	url: "/getSipTransport",
        	type: "post"
        },
        'order': [[1, 'asc']],
        "columns": [
    				{ "data": null},        	
    				{ "data": "name"},       
    		        { "data": "vipName"},	
    		        { "data": "svcType" },	
    		        { "data": "transType" }, 	
    		        { "data": "sigPort"}, 		
    		        { "data": "forkingMinport"},				
    		        { "data": "forkingMaxport"},
    		        { "data": "qosType"}, 	
    		        { "data": "qosValue"} 
    		    ],
    	'columnDefs': [	 
				{'targets': 0, 'className': 'text-center',  'searchable': false,  'orderable': false},   
				{'targets': 1, 'className': 'text-center'}, 
				{'targets': 2, 'className': 'text-center'},    
				{'targets': 3, 'className': 'text-center', 'render': function (data, type, full, meta){ return getVipName(data); }},    
				{'targets': 4, 'className': 'text-center', 'render': function (data, type, full, meta){ return getTransType(data); }},    
				{'targets': 5, 'className': 'text-center'},    
				{'targets': 6, 'className': 'text-center'},    
				{'targets': 7, 'className': 'text-center'},    
				{'targets': 8, 'className': 'text-center', 'render': function (data, type, full, meta){ return getQosType(data); }},    
				{'targets': 9, 'className': 'text-center', 'render': function (data, type, full, meta){ return numberToHex(data); }},    
    	 ]
	});
	
	tableMedia = $('#dtMedia').DataTable({
		"sDom": sDom,
		"oLanguage": oLanguage,
		"autoWidth" : true,
		"tableTools":tableTools,
		"scrollY" : "400px",
		"scrollX" : false,
			"scrollCollapse": true,
		"paging": false,
		"processing": true,
        "ajax": {
        	url: "/getMediaTransport",
        	type: "post"
        },
        'order': [[1, 'asc']],
        "columns": [
    				{ "data": null},        	
    				{ "data": "name"},       
    		        { "data": "vipName"},	
    		        { "data": "minPort"},				
    		        { "data": "maxPort"},
    		        { "data": "qosType"}, 	
    		        { "data": "qosValue"} 
    		    ],
    	'columnDefs': [	 
				{'targets': 0, 'className': 'text-center',  'searchable': false,  'orderable': false},   
				{'targets': 1, 'className': 'text-center'}, 
				{'targets': 2, 'className': 'text-center'},    
				{'targets': 3, 'className': 'text-center'},  
				{'targets': 4, 'className': 'text-center'},    
				{'targets': 5, 'className': 'text-center'},    
				{'targets': 6, 'className': 'text-center', 'render': function (data, type, full, meta){ return numberToHex(data); }},    
    	 ]
	});
	
	tableNat = $('#dtNat').DataTable({
		"sDom": sDom,
		"oLanguage": oLanguage,
		"autoWidth" : true,
		"tableTools":tableTools,
		"scrollY" : "400px",
		"scrollX" : false,
		"scrollCollapse": true,
		"paging": false,
		"processing": true,
        "ajax": {
        	url: "/getNatTransport",
        	type: "post"
        },
        'order': [[1, 'asc']],
        "columns": [
    				{ "data": null},        	
    				{ "data": "name"},       
    		        { "data": "vipName"},	
    		        { "data": "minPort"},				
    		        { "data": "maxPort"},
    		        { "data": "protocol"}, 	
    		        { "data": null}, 
    		        { "data": null}, 
    		        { "data": null}
    		    ],
    	'columnDefs': [	 
				{'targets': 0, 'className': 'text-center',  'searchable': false,  'orderable': false},   
				{'targets': 1, 'className': 'text-center'}, 
				{'targets': 2, 'className': 'text-center'},    
				{'targets': 3, 'className': 'text-center'},    
				{'targets': 4, 'className': 'text-center'},    
				{'targets': 5, 'className': 'text-center'},    
				{'targets': 6, 'className': 'text-center'},    
				{'targets': 7, 'className': 'text-center'},    
				{'targets': 8, 'className': 'text-center'}
    	 ]
	});
	
	//	seq number
	tableSip.on( 'order.dt search.dt', function () {
		tableSip.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
            cell.innerHTML = i+1;
        } );
    } ).draw();
	
	tableMedia.on( 'order.dt search.dt', function () {
		tableMedia.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
            cell.innerHTML = i+1;
        } );
    } ).draw();
	
	tableNat.on( 'order.dt search.dt', function () {
		tableNat.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
            cell.innerHTML = i+1;
        } );
    } ).draw();
	
	//	click row
	tableSip.on( 'click', 'tr', function () {
		tableSip.$('tr.selected').removeClass('selected');
		$(this).addClass('selected');
	});
	
	tableMedia.on( 'click', 'tr', function () {
		tableMedia.$('tr.selected').removeClass('selected');
		$(this).addClass('selected');
	});
	
	tableNat.on( 'click', 'tr', function () {
		tableNat.$('tr.selected').removeClass('selected');
		$(this).addClass('selected');
	});
	
	//===================================== Sip Modal =====================================================
	
	// 추가버튼 - Sip
	$("#btnAddSip").click(function(){
		validatorSip.resetForm();
		$("#frmSip #hidOpMode").val("2"); // add
		$("#frmSip [name=lblClass]").removeClass("state-disabled"); // state-disabled
		
		setControlInput("frmSip", "name", '', false); // name
		setControlInput("frmSip", "sigPort", '', false); // sigPort
		setControlInput("frmSip", "forkingMinport", '', false); // forkingMinPort
		setControlInput("frmSip", "forkingMaxport", '', false); // forkingMaxport
		setControlInput("frmSip", "qosValue", '', false); // qosValue
		
			$.post("/getInterfaceAliasList",{},function(json){
				var list=json.data;
				
				setVipNameList($("#frmSip #vipName"), list, '');
				$("#frmSip #vipName").attr("disabled", false);
				
				showModal($("#modalSip"));
				$("#titleModalSip").html("Add SIP Transport");
			});
	});
	
	// 변경버튼 - Sip
	$("#btnChangeSip").click(function(){
		var data = tableSip.rows('.selected').data();
		if(data.length==0){
			showMsg("Edit Interface", "Select a row to edit.");
		}else{
			var item=data[0];
			
			validatorSip.resetForm();
			$("#frmSip #hidOpMode").val("3"); // add opMode
			$("#frmSip [name=lblClass]").addClass("state-disabled"); // state-disabled
			
			setControlInput("frmSip", "name", item.name, true); // name
			setControlInput("frmSip", "sigPort", item.sigPort, true); // sigPort
			setControlInput("frmSip", "forkingMinport", item.forkingMinport, true); // forkingMinPort
			setControlInput("frmSip", "forkingMaxport", item.forkingMaxport, true); // forkingMaxport
			setControlInput("frmSip", "qosValue", item.qosValue, false); // qosValue
			setControlRadio("frmSip", "svcType", item.svcType, true); // svcType 서비스유형
			setControlRadio("frmSip", "transType", item.transType, true); // transType 전송유형
			setControlRadio("frmSip", "qosType", item.qosType, false); // qosType
			
			$.post("/getInterfaceAliasList",{},function(json){
				var list=json.data;
				// NIC Alias
				setVipNameList($("#frmSip #vipName"), list, item.vipName); //item.vipName);
				$("#frmSip #vipName").attr("disabled", true);
				
				// show modal
				showModal($("#modalSip"));
				$("#titleModalSip").html("Edit SIP Transport");
			});
		}
	});
	
	// 삭제버튼
	$("#btnRemoveSip").click(function(){ 
		var data = tableSip.rows('.selected').data();
		if(data.length==0){
			showMsg("Delete", "Select a row to delete.");
		}else{
			//showConfirm('Confirm', data[0].name + " 정보를 삭제 하시겠습니까?");
			showConfirm('Confirm', "Do you want to delete [" + data[0].name + "] ?");
			
			$("#btnConfirm").unbind('click');
			$("#btnConfirm").click(function(){
				showLoader();
				var param = data[0];
				param.opMode=4; // remove opMode
				$.ajax({
					url: '/takeSipTransport',
				    type: "post",
				    data: param,
				    success: function(json) {
				    	processResult(json.result, null, tableSip, null);
				    }
				});
			});
		}
	});
	
	
	//  새로고침
	$("#btnRefreshSip").click(function(){
		tableSip.ajax.reload(null, false);
	});
	
	
	// Sip Transport Modal 저장버튼
	$("#btnSaveSip").click(function(){
		var name = $("#frmSip #name").val();
		var vipName = $("#frmSip #vipName").val();
		var sigPort = $("#frmSip #sigPort").val();
		var forkingMinport = $("#frmSip #forkingMinport").val();
		var forkingMaxport = $("#frmSip #forkingMaxport").val();
 		
 		if(!$("#frmSip").valid()){
 			return;
 		}
 		
 		if(forkingMinport != '' && forkingMaxport != ''){
	 		if(forkingMinport >= forkingMaxport){
	 			showMsg("Warning", "Forking Port Range is Wrong");
	 			return;
	 		}
 		}
 		
 		if(forkingMinport=='' || forkingMaxport==''){
			$("#frmSip #forkingMinport").val(0);
			$("#frmSip #forkingMaxport").val(0);
		}
 		
		showConfirm('Confirm', "Do you want to save?");
	
		$("#btnConfirm").unbind('click');
		$("#btnConfirm").click(function(){
			showLoader();
			$("#frmSip").submit();  
		});
		
	});
	
	validatorSip = $('#frmSip').validate({
// 		onfocusout: function(element) {$(element).valid()},
// 		onkeyup: function(element) {$(element).valid();},
		rules : {
			name:{
				required : true,
				rangelength: [1, 16]
			},
			vipName:{required : true},
			sigPort:{
				required : true , 
				number:true,
				min: 0,
				max: 65535,
			},
			forkingMinport:{
				number:true,
				min: 0,
				max: 65535,
			}, 
			forkingMaxport:{
				number:true,
				min: 0,
				max: 65535,
			}, 
			qosValue:{ 
				minlength: 2,
				maxlength: 2,
				pattern: /^[\A-Fa-f0-9\.]+$/  
			}, 
		},
		messages : {
			name:{
				required : 'Input name.',
				rangelength: 'name is 1~16 length'
			},
			vipName:{
				required : 'Select NIC Alias.'
			},
			sigPort:{
				required : 'Input service port.', 
				number : 'Input number.',
				min: 'range is 0 ~ 65535',
				max: 'range is 0 ~ 65535',
			},
			forkingMinport:{
				number : 'Input number.',
				min: 'range is 0 ~ 65535',
				max: 'range is 0 ~ 65535',
			},
			forkingMaxport:{
				number : 'Input number.',
				min: 'range is 0 ~ 65535',
				max: 'range is 0 ~ 65535',
			},
			qosValue:{
				minlength: 'value is 2 length',
				maxlength: 'value is 2 length',
				pattern: 'need hexadecimal',
			},
		},
		errorPlacement : function(error, element) {
			error.insertAfter(element.parent());
		},
	});
	
	$("#frmSip").ajaxForm({
		url: "/takeSipTransport",
		type: "POST",
		beforeSubmit: function(arr, $form, options){ 
			var opMode=$("#frmSip #hidOpMode").val(); 

			// qosValue : hex => Number
			var qosValue = hexToNumber(getControlInput("frmSip", "txtQosValue"));;
			arr.push({name:'qosValue', value: (qosValue=='')?0:qosValue}); 
			
			if(opMode==3){
				var item = tableSip.rows('.selected').data()[0];
				
				arr.push({name:'name', value: item.name}); 
				arr.push({name:'vipName', value: item.vipName}); 
				arr.push({name:'sigPort', value: item.sigPort}); 
				arr.push({name:'svcType', value: item.svcType}); 
				arr.push({name:'transType', value: item.transType}); 
				arr.push({name:'forkingMinport', value: item.forkingMinport}); 
				arr.push({name:'forkingMaxport', value: item.forkingMaxport}); 
				
				//alert(item.name + ' , ' + item.vipName + ' , ' + item.sigPort + ' , ' + item.svcType + ' , ' + item.transType + ' , ' + item.forkingMinport + ' , ' + item.forkingMaxport);
				
			}
		},
		success: function(responseText, statusText, xhr, $form){
			processResult(responseText.result, "modalSip", tableSip, null);
		}
	});
	
	//===================================== Media Modal =====================================================
	$("#btnAddMedia").click(function(){
		validatorMedia.resetForm();
		$("#frmMedia #hidOpMode").val("2"); // add
		$("#frmMedia [name=lblClass]").removeClass("state-disabled"); // state-disabled
		// set clear
		$("#frmMedia #name").val('');
		$("#frmMedia #name").attr("disabled", false);
		
		$("#frmMedia #vipName").val('');
		$("#frmMedia #vipName").attr("disabled", false);
		
		$("#frmMedia #minPort").val('');
		$("#frmMedia #minPort").attr("disabled", false);
		
		$("#frmMedia #maxPort").val('');
		$("#frmMedia #maxPort").attr("disabled", false);
		
		$("#frmMedia #qosValue").val('');
		
		$.post("/getInterfaceAliasList",{},function(json){
			var data=json.data;
			setVipNameList($("#frmMedia #vipName"), data, '');
			
			// show modal
			showModal($("#modalMedia"));
			$("#titleModalMedia").html("Add Media Transport");
		});
	});
	
	// 변경버튼 - Media
	$("#btnChangeMedia").click(function(){
		var data = tableMedia.rows('.selected').data();
		if(data.length==0){
			showMsg("Edit", "Select a row to edit.");
		}else{
			var item=data[0];
			validatorMedia.resetForm();
			$("#frmMedia #hidOpMode").val("3"); // change opMode
			$("#frmMedia [name=lblClass]").addClass("state-disabled"); // state-disabled
			
			 // name
			$("#frmMedia #name").val(item.name);
			$("#frmMedia #name").attr("disabled", true);
			
			// 포킹포트범위
			$("#frmMedia #minPort").val(item.minPort);
			$("#frmMedia #minPort").attr("disabled", true);
			$("#frmMedia #maxPort").val(item.maxPort);
			$("#frmMedia #maxPort").attr("disabled", true);
			
			// qosValue
			if($("#frmMedia #qosValue").val()=="0"){
				$("#frmMedia #qosValue").val('');
			}
			
			
			$.post("/getInterfaceAliasList",{},function(json){
				var list=json.data;
				setVipNameList($("#frmMedia #vipName"), list, item.vipName);
				$("#frmMedia #vipName").attr("disabled", true);
				
				// show modal
				showModal($("#modalMedia"));
				$("#titleModalMedia").html("Edit Media Transport");
			});
		}
	});
	
	// 삭제버튼
	$("#btnRemoveMedia").click(function(){ 
		var data = tableMedia.rows('.selected').data();
		if(data.length==0){
			showMsg("Delete", "Select a row to delete.");
		}else{
			showConfirm('Confirm', "Do you want to delete [" + data[0].name + "] ?");
			
			$("#btnConfirm").unbind('click');
			$("#btnConfirm").click(function(){
				showLoader();
				var param = data[0];
				param.opMode=4; // remove opMode
				$.ajax({
					url: '/takeMediaTransport',
				    type: "post",
				    data: param,
				    success: function(json) {
				    	processResult(json.result, null, tableMedia, null);
				    }
				});
			});
		}
	});
	
	//  새로고침
	$("#btnRefreshMedia").click(function(){
		tableMedia.ajax.reload(null, false);
	});
	
	// Media Transport Modal 저장버튼
	$("#btnSaveMedia").click(function(){
		var name = $("#frmMedia #name").val();
		var vipName = $("#frmMedia #vipName").val();
		var minPort = $("#frmMedia #minPort").val();
		var maxPort = $("#frmMedia #maxPort").val();
 		if(!$("#frmMedia").valid()){
 			return;
 		}
 		
		if(!$("#frmMedia").valid()){
 			return;
		}
 		
		showConfirm('Confirm', "Do you want to save ?");
	
		$("#btnConfirm").unbind('click');
		$("#btnConfirm").click(function(){
			showLoader();
			$("#frmMedia").submit();  
		});
		
	});
	
	validatorMedia = $('#frmMedia').validate({
// 		onfocusout: function(element) {$(element).valid()},
// 		onkeyup: function(element) {$(element).valid();},
		rules : {
			name:{required : true},
			vipName:{required : true},
			minPort:{required : true, number:true}, 
			maxPort:{required : true, number:true}, 
			qosValue:{ 
				minlength:2,
				maxlength:2,
				pattern: /^[\A-Fa-f0-9\.]+$/  
			}, 
		},
		messages : {
			name:{required : 'Input name.'},
			vipName:{required : 'Select NIC Alias'},
			minPort:{required : 'Input MinPort', number : 'Input number'},
			maxPort:{required : 'Input MaxPort',number : 'Input number'},
			qosValue:{
				minlength: 'value is 2 length',
				maxlength: 'value is 2 length',
				pattern: 'Input proper value',
			},
		},
		errorPlacement : function(error, element) {
			error.insertAfter(element.parent());
		},
	});
	
	$("#frmMedia").ajaxForm({
		url: "/takeMediaTransport",
		type: "POST",
		beforeSubmit: function(arr, $form, options){ 
			var opMode=$("#frmMedia #hidOpMode").val(); 
			if(opMode==3){
				var item = tableMedia.rows('.selected').data()[0];
				
				arr.push({name:'name', value: item.name}); 
				arr.push({name:'vipName', value: item.vipName}); 
				arr.push({name:'minPort', value: item.minPort}); 
				arr.push({name:'maxPort', value: item.maxPort}); 
			}
			
		},
		success: function(responseText, statusText, xhr, $form){
			processResult(responseText.result, "modalMedia", tableMedia, null);
		}
	});
	
	//===================================== Nat Modal =====================================================
	$("#btnAddNat").click(function(){
		validatorNat.resetForm();
		$("#frmNat #hidOpMode").val("2"); // add
		$("#frmNat [name=lblClass]").removeClass("state-disabled");
		// set clear
		$("#frmNat #name").val('');
		$("#frmNat #name").attr("disabled", false);
		
		$("#frmNat #vipName").val('');
		$("#frmNat #vipName").attr("disabled", false);
		
		$("#frmNat #minPort").val('');
		$("#frmNat #maxPort").val('');
		$("#frmNat #minPort").attr("disabled", false);
		$("#frmNat #maxPort").attr("disabled", false);
		
		$.post("/getInterfaceAliasList",{},function(json){
			var data=json.data;
			// 인터페이스명 list
			setVipNameList($("#frmNat #vipName"), data, '');
			
			// show modal
			showModal($("#modalNat"));
			$("#titleModalNat").html("Nat Transport 추가");
		});
	});
	
	// 변경버튼 - Nat
	$("#btnChangeNat").click(function(){
		var data = tableNat.rows('.selected').data();
		if(data.length==0){
			showMsg("Edit", "Select a row to edit");
		}else{
			var item=data[0];
			validatorNat.resetForm();
			$("#frmNat #hidOpMode").val("3"); // change opMode
			$("#frmNat [name=lblClass]").addClass("state-disabled"); // state-disabled
			
			 // name
			$("#frmNat #name").val(item.name);
			$("#frmNat #name").attr("disabled", true);
			
			// 포트범위
			$("#frmNat #minPort").val(item.minPort);
			$("#frmNat #minPort").attr("disabled", true);
			$("#frmNat #maxPort").val(item.maxPort);
			$("#frmNat #maxPort").attr("disabled", true);
			
			$.post("/getInterfaceAliasList",{},function(json){
				var list=json.data;
				
				setVipNameList($("#frmNat #vipName"), list, item.vipName);
				$("#frmNat #vipName").attr("disabled", true);
				
				// show modal
				showModal($("#modalNat"));
				$("#titleModalNat").html("NAT Transport 변경");
			});
		}
	});
	
	// 삭제버튼
	$("#btnRemoveNat").click(function(){ 
		var data = tableNat.rows('.selected').data();
		if(data.length==0){
			showMsg("Delete", "Select a row to delete.");
		}else{
			showConfirm('Confirm', "Do you want to delete [" + data[0].name + "] ?");
			
			$("#btnConfirm").unbind('click');
			$("#btnConfirm").click(function(){
				showLoader();
				var param = data[0];
				param.opMode=4; // remove opMode
				$.ajax({
					url: '/takeNatTransport',
				    type: "post",
				    data: param,
				    success: function(json) {
				    	processResult(json.result, null, tableNat, null);
				    }
				});
			});
		}
	});
	
	//  새로고침
	$("#btnRefreshNat").click(function(){
		tableNat.ajax.reload(null, false);
	});
	
	// NAT Transport Modal 저장버튼
	$("#btnSaveNat").click(function(){
		var name = $("#frmNat #name").val();
		var vipName = $("#frmNat #vipName").val();
		var minPort = $("#frmNat #minPort").val();
		var maxPort = $("#frmNat #maxPort").val();
 		
		if(!$("#frmNat").valid()){
 			return;
 		}
 		
		showConfirm('Confirm', "Do you want to save ?");
	
		$("#btnConfirm").unbind('click');
		$("#btnConfirm").click(function(){
			showLoader();
			$("#frmNat").submit();  
		});
		
	});
	
	validatorNat = $('#frmNat').validate({
		rules : {
			name:{required : true},
			vipName:{required : true},
			minPort:{required : true, number:true}, 
			maxPort:{required : true, number:true}, 
		},
		messages : {
			name:{required : 'Input name'},
			vipName:{required : 'Input NIC Alias'},
			minPort:{required : 'Input MinPort', number : 'Input number'},
			maxPort:{required : 'Input MaxPort',number : 'Input number'},
		},
		errorPlacement : function(error, element) {
			error.insertAfter(element.parent());
		},
	});
	
	$("#frmNat").ajaxForm({
		url: "/takeNatTransport",
		type: "POST",
		beforeSubmit: function(arr, $form, options){ 
			var opMode=$("#frmNat #hidOpMode").val(); 
			if(opMode==3){
				var item = tableNat.rows('.selected').data()[0];
				
				arr.push({name:'name', value: item.name}); 
				arr.push({name:'vipName', value: item.vipName}); 
				arr.push({name:'minPort', value: item.minPort}); 
				arr.push({name:'maxPort', value: item.maxPort}); 
			}
		},
		success: function(responseText, statusText, xhr, $form){
			processResult(responseText.result, "modalNat", tableNat, null);
		}
	});
	
} // pagefunction
$('body').append( $('<div>').load("/resources/html/common.html"));

loadScript("/resources/js/plugin/datatables/jquery.dataTables.min.js", function(){
	loadScript("/resources/scripts/common/dataTables.js", function(){
		loadScript("/resources/scripts/common/controls.js", pagefunction);
	});
});


function setVipNameList(obj, data, val){
	obj.empty();
	obj.append("<option value=''  selected='' disabled=''>choose alias...</option>");
	for(var i=0; i<data.length; i++){
		obj.append("<option value='"+data[i].intfAlias+"'>"+data[i].intfAlias+" ("+data[i].ip+")</option>");
	}
	obj.val(val);

}


	
</script>	
