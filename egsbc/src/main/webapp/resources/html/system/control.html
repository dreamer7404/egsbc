<!-- widget grid -->
<section id="widget-grid" class="">

	<!-- row -->
	<div class="row">

		<!-- NEW WIDGET START -->
		<article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">

			<!-- Widget ID (each widget will need unique ID)-->
			<div class="jarviswidget jarviswidget-color-blueDark" id="wid-id-1" data-widget-editbutton="false">
				<header >
					<span class="widget-icon"> <i class="fa fa-table"></i> </span>
					<h2>System Control </h2>
				</header>
				<!-- widget div-->
				<div class="div-widget" >
						<form class="smart-form" id="frmSystem"  novalidate="novalidate">
							<table border="0" style="margin:0 0 20px 20px">
							<tr>
								<td width="100px" style="padding:10px 20px 10px 10px;text-align:right">Host</td>
								<td width="160px">
									<label class="select">
										<select name="controlHost"  id="controlHostSystem">
											<option value="" selected="" disabled="">choose host...</option>
											<option value="0">A</option>
											<option value="1">B</option>
											<option value="2">Both</option>
										</select> <i></i> 
									</label>
								</td>
								<td></td>
							</tr>
							<tr>
								<td style="padding:10px 20px 10px 10px;text-align:right">Control</td>
								<td colspan="2">
									<div class="inline-group">
										<label class="radio">
											<input type="radio" name="systemControlMode" value="0" checked>
											<i></i>Restart</label>
										<label class="radio">
											<input type="radio" name="systemControlMode" value="1">
											<i></i>Power Off</label>
										<label class="radio">
											<input type="radio" name="systemControlMode" value="2">
											<i></i>Switch Over</label>
										<label class="radio">
											<input type="radio" name="systemControlMode" value="3">
											<i></i>Change Dup Mode</label>		
									</div>
								</td>
							</tr>	
							<tr>
								<td style="padding:10px 20px 10px 10px;text-align:right">Dup Mode</td>
								<td colspan="2">
									<div class="inline-group">
										<label id="lblOperatingMode1" class="radio state-disabled">
												<input type="radio" name="systemControlOpMode" value="0" checked  disabled="disabled">
												<i></i>Single</label>
										<label  id="lblOperatingMode2" class="radio state-disabled">
											<input type="radio" name="systemControlOpMode" value="1"  disabled="disabled">
											<i></i>Dual</label>
									</div>
								</td>
							</tr>	
							<tr>
								<td>&nbsp;</td>
								<td colspan="2" align="left">
									<button class="btn btn-default btn-apply" id="btnApplySystem"> Apply</button>
								</td>
							</tr>
							</table>
						</form>
				
						<table id="dtDup" class="table table-striped table-bordered table-hover"   >
							<thead>
								<tr>
									<th class="text-center">Host</th>
									<th class="text-center">Role</th>
									<th class="text-center">Mode</th>
									<th class="text-center">IP</th>
									<th class="text-center">HeartBeat</th>
									<th class="text-center">SysUptime</th>
								</tr>
							</thead>
						</table>
						<div class="form-group text-right">
							<button class="btn btn-default btn-refresh" id="btnRefreshDup"> Refresh</button>
						</div>
				</div>
			</div>
			
			<!-- Process Control -->
			<div class="jarviswidget jarviswidget-color-lightBlue" id="wid-id-3" data-widget-editbutton="false">
				<header>
					<span class="widget-icon"> <i class="fa fa-table"></i> </span>
					<h2>Process Control </h2>
				</header>

				<!-- widget div-->
				<div>
				
						<form class="smart-form" id="frmProcess"  novalidate="novalidate">
							<table border="0" style="margin:0 0 20px 20px">
							<tr>
								<td width="100px" style="padding:10px 20px 10px 10px;text-align:right">Host</td>
								<td width="200px">
									<label class="select">
										<select name="controlHost"  id="controlHostProcess">
											<option value="" selected="" disabled="">choose host...</option>
											<option value="0">A</option>
											<option value="1">B</option>
											<option value="2">Both</option>
										</select> <i></i> 
									</label>
								</td>
							</tr>
							<tr>
								<td style="padding:10px 20px 10px 10px;text-align:right">Process Name</td>
								<td >
									<label class="select">
										<select name="process"  id="process">
											<option value="" selected="" disabled="">Choose...</option>
											<option value="0">ALL</option>
											<option value="1">DPB</option>
											<option value="2">HAB</option>
											<option value="3">MCB</option>
											<option value="4">MRM</option>
											<option value="5">PMB</option>
											<option value="6">SMB</option>
											<option value="7">SPB</option>
											<option value="8">UCB</option>
										</select> <i></i> 
									</label>
								</td>
							</tr>	
							<tr>
								<td style="padding:10px 20px 10px 10px;text-align:right">Control Mode</td>
								<td >
									<div class="inline-group">
										<label class="radio">
												<input type="radio" name="processControlMode" value="0" checked>
												<i></i>Restart</label>
										<label class="radio">
											<input type="radio" name="processControlMode" value="1">
											<i></i>Stop</label>
									</div>
								</td>
							</tr>	
							<tr>
								<td>&nbsp;</td>
								<td  align="left">
									<button class="btn btn-default btn-apply" id="btnApplyProcess"> Apply</button>
								</td>
							</tr>
							</table>
						</form>
				
				
						<table id="dtProcess" class="table table-striped table-bordered table-hover"   >
							<thead>
								<tr>
									<th class="text-center">Host</th>
									<th class="text-center">Process Name</th>
									<th class="text-center">Status</th>
									<th class="text-center">Package Version</th>
									<th class="text-center">Process Version</th>
									<th class="text-center">Install Date</th>
									<th class="text-center">Start/Stop Date</th>
								</tr>
							</thead>
						</table>
						<div class="form-group text-right">
							<button class="btn btn-default btn-refresh" id="btnRefreshProcess"> Refresh</button>
						</div>
				</div>
			</div>
			
			
			
			
		</article>
	</div>			
</section>	
<script type="text/javascript">
var tableDup, tableProcess;
var validatorDup, validatorProcess;

var pagefunction = function() {
	
	
	
	tableDup = $('#dtDup').DataTable({
		"sDom": sDom,
		"oLanguage": oLanguage,
		"autoWidth" : true,
		"tableTools":tableTools,
		"scrollY" : "400px",
		"scrollX" : false,
		"scrollCollapse": true,
		"paging": false,
		"processing": true,
        "ajax": {
        	url: "/getPrimitiveSysDup",
        	type: "post"
        },
        'order': [[0, 'asc']],
        "columns": [
    				{ "data": "side"},       
    		        { "data": "role"},	
    		        { "data": "dualFlag" },	
    		        { "data": "mgmtIp" }, 	
    		        { "data": "heartbeatStatus"}, 		
    		        { "data": "sysUpTime"},				
    		    ],
    	'columnDefs': [	 
				{'targets': 0, 'className': 'text-center', 'render': function (data, type, full, meta){ return getSideValue(data); }},
				{'targets': 1, 'className': 'text-center', 'render': function (data, type, full, meta){ return getRole(data); }},
				{'targets': 2, 'className': 'text-center', 'render': function (data, type, full, meta){ return getSystemMode(data); }},
				{'targets': 3, 'className': 'text-center'},
				{'targets': 4, 'className': 'text-center', 'render': function (data, type, full, meta){ return getHeartBeat(data); }},
				{'targets': 5, 'className': 'text-center', 'render': function (data, type, full, meta){ return getDatetime(data); }}, 
    	 ]
	});
	
	tableProcess = $('#dtProcess').DataTable({
		"sDom": sDom,
		"oLanguage": oLanguage,
		"autoWidth" : true,
		"tableTools":tableTools,
		"scrollY" : "400px",
		"scrollX" : false,
		"scrollCollapse": true,
		"paging": false,
		"processing": true,
        "ajax": {
        	url: "/getPrimitiveSysProcess",
        	type: "post"
        },
        'order': [[0, 'asc']],
        "columns": [
					{ "data": "side"},       
    				{ "data": "blkName"},       
    		        { "data": "status"},	
    		        { "data": "pkgVer" },	
    		        { "data": "blkVer" }, 	
    		        { "data": "dateInstall"}, 		
    		        { "data": "dateStart"},	
    		    ],
    	'columnDefs': [	 
				{'targets': 0, 'className': 'text-center', 'render': function (data, type, full, meta){ return getSideValue(data); }},
				{'targets': 1, 'className': 'text-center'}, 
				{'targets': 2, 'className': 'text-center', 'render': function (data, type, full, meta){ return getStatus(data); }}, 
				{'targets': 3, 'className': 'text-center'},    
				{'targets': 4, 'className': 'text-center'},
				{'targets': 5, 'className': 'text-center', 'render': function (data, type, full, meta){ return getDatetime(data); }}, 
				{'targets': 6, 'className': 'text-center', 'render': function (data, type, full, meta){ return getDatetime(data); }}, 
			]
	});
	
	/*
	============================== dup =============================================
	*/
	
	$("input:radio[name='systemControlMode']").change(function() { 
		var val=$(this).val();
		if(val==3){
			 $("#lblOperatingMode1").removeClass('state-disabled');
			 $("#lblOperatingMode2").removeClass('state-disabled');
			$("input:radio[name='systemControlOpMode']").attr("disabled", false);
		}else{
			$("#lblOperatingMode1").addClass('state-disabled');
			$("#lblOperatingMode2").addClass('state-disabled');
			$("input:radio[name='systemControlOpMode']").attr("disabled", true);
		}
	});
	
	
	// 시스템 적용
	$("#btnApplySystem").click(function(){
		
		var controlHost = $("#controlHostSystem").val();
		if(controlHost==null){
			$('#frmSystem').valid();
			return;
		}
		
 		var controlMode = $("input:radio[name='controlMode']:checked").val();
 		showConfirm('Confirm', "Do you want to execute [ host : " + getControlHost(controlHost) + ", mode : "+ getControlMode(controlMode) + "] ?");
 		
 		$("#btnConfirm").unbind('click');
		$("#btnConfirm").click(function(){
			showLoader();
			$("#frmSystem").submit();
		});
		
	});
	
	validatorDup = $('#frmSystem').validate({
		onfocusout: function(element) {$(element).valid()},
		onkeyup: function(element) {$(element).valid();},
		rules : {
			controlHost:{required : true},
		},
		messages : {
			controlHost:{required : 'select host'},
		},
		errorPlacement : function(error, element) {
			error.insertAfter(element.parent());
		},
	});
	
	$("#frmSystem").ajaxForm({
		url: "/applySystem",
		type: "POST",
		beforeSubmit: function(arr, $form, options){
		},
		success: function(responseText, statusText, xhr, $form){
			processResult(responseText.result, null, null, "appled OK.");
		}
	});
	
	
	$("#btnRefreshDup").click(function(){
		tableDup.ajax.reload(null, false);
	});
	

	/*
	============================== process =============================================
	*/
	
	
	$("#btnApplyProcess").click(function(){
		
		var controlHost = $("#controlHostProcess").val(); 
		if(controlHost==null){
			$('#frmProcess').valid();
			return;
		}
		
 		var process = $("#process").val(); 
 		var processText = $("#process option:selected").text(); 
 		
 		var processControlMode = $("input:radio[name='processControlMode']:checked").val();
 		
 		showConfirm('Confirm', "Do you wnat to execute ?<br />[ host : " + getControlHost(controlHost) + ", process : "+ processText + ", mode : " + getProcessControlMode(processControlMode) + "]");
 		
 		$("#btnConfirm").unbind('click');
		$("#btnConfirm").click(function(){
			showLoader();
			$("#frmProcess").submit();
		});
		
	});
	
	validatorProcess = $('#frmProcess').validate({
		onfocusout: function(element) {$(element).valid()},
		onkeyup: function(element) {$(element).valid();},
		rules : {
			controlHost:{required : true},
		},
		messages : {
			controlHost:{required : 'select host'},
		},
		errorPlacement : function(error, element) {
			error.insertAfter(element.parent());
		},
	});
	
	$("#frmProcess").ajaxForm({
		url: "/applyProcess",
		type: "POST",
		beforeSubmit: function(arr, $form, options){
		},
		success: function(responseText, statusText, xhr, $form){
			processResult(json.result, null, null, "Applied OK");
		}
	});
	
	$("#btnRefreshProcess").click(function(){
		tableProcess.ajax.reload(null, false);
	});
	

} // pagefunction

$('body').append( $('<div>').load("/resources/html/common.html"));

loadScript("/resources/js/plugin/datatables/jquery.dataTables.min.js", function(){
	loadScript("/resources/scripts/common/dataTables.js", function(){
		loadScript("/resources/scripts/common/controls.js", pagefunction);
	});
});


//======================== functions ===================================================================

function getRole(val){
	if(val==0) return "Active";
	else if(val==1) return "Standby";
	else return "";
}	
function getSystemMode(val){
	if(val==0) return "Single";
	else if(val==1) return "Dual";
	else return "";
}	
function getHeartBeat(val){
	if(val==0) return "Off";
	else if(val==1 || val==2) return "On";
	else return "";
}	
	
function getControlHost(val){
	if(val==0) return "A";
	else if (val==1) return "B";
	else if (val==2) return "Both";
	else return "";
}
function getControlMode(val){
	if(val==0) return "restart";
	else if (val==1) return "Power Off";
	else if (val==2) return "switchover";
	else if (val==3) return "change op mode";
	else return "";
}
function getProcessControlMode(val){
	if(val==0) return "restart";
	else if (val==1) return "stop";
	else return "";
}
function getStatus(val){
	if(val==0) return "Stopped";
	else if (val==1) return "Starting";
	else if (val==2) return "Started";
	else return "";
}
</script>